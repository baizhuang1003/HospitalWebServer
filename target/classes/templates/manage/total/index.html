<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="manage/shared/_layout::header('认证管理')">
</head>
<body>
<div class="easyui-layout" data-options="fit:true">
    <div id="north" data-options="region:'north'" style="height:38px; ">
        <th>
        	<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'fa fa-cog'" onclick="modifyCert()">审核</a>
        </th>
    </div>
    <div data-options="region:'center',iconCls:'icon-grid'">
        <table id="dg"></table>
    </div>
</div>
<div id="dlg" class="easyui-dialog" style="width:400px;padding:20px;" data-options="closed:true,modal:true,border:'thin',buttons:'#dlg-buttons'">
</div>
<div id="dlg-buttons">
    <a href="javascript:void(0)" class="easyui-linkbutton primary" onclick="saveModel()" style="width: 80px; color: #FFFFFF; background: #1c68bc; border: 1px solid #1c68bc;">保存</a>
    <a href="javascript:void(0)" class="easyui-linkbutton" onclick="javascript:$('#dlg').dialog('close')" style="width: 80px; color: #FFFFFF; background: #1c68bc; border: 1px solid #1c68bc;">取消</a>
</div>
<script type="text/javascript">
$(function(){
	makeGrid();
})
function makeGrid() {
	$('#dg').datagrid({
		url: '/manage/certification/list',
		idField: 'id',
		rownumbers: true,
		singleSelect: true,
		queryParams: {},
		fit:true,
		pagination: true,
		rownumbers:true,
		pageSize: 20,
		pageList: [10, 20, 30, 40, 50],
		columns: [
        	[
        		{ field:'id',title:'编号',width:150,align:'center' },
        		//{ field:'region',title:'地区编码',width:120,align:'center' },
        		{ field:'organization',title:'部门名称',width:250,align:'center' },
        		{ field:'abbreviation',title:'备注',width:160,align:'center' },
        		{ field:'phone',title:'电话',width:160,align:'center' },
        		{ field:'email',title:'邮箱',width:160,align:'center' },
        		{ field:'website',title:'网址',width:160,align:'center' },
        		{ field:'site',title:'地址',width:200,align:'center' },
        		{ field:'certificationstatus',title:'认证状态',width:160,align:'center',formatter:function(value){ 
        			if(value==0){ return "待审核"; } 
        			else if(value==1){ return "已审核"; } 
        			else if (value ==2){ return "未通过";}
    				else {return "";}
        			}
        		},
        		{ field:'businesslicense',title:'营业执照',width:160,align:'center',formatter:function(value){return "查看"} },
        	]
        ]
	});
}

function modifyCert(){
	 var row = $('#dg').datagrid('getSelected');
       if (row) {
       	if(row.state==1 || row.state ==2 || row.state == 3 || row.state == 4){
       		messageAlert('提示', '该机构已审核或已作废。', 'info');
       		return;
       	}
			$('#dlg').dialog({ href: '/manage/certification/cert?id='+ row.id, title: '审核' }).dialog('open').dialog('center');
       }
       
}

function saveModel(){
	 $('#dlg').find('#certificationstatus').val($('input[name=stateRadio]:checked').val());
	 alert($('input[name=stateRadio]:checked').val())
	   $('#dlg').find('form:eq(0)').form('submit', {
           url: '/manage/certification/cert',
           onSubmit: function () {
               return $(this).form('validate');
           },
           success: function (result) {
               var result = eval('(' + result + ')');
               if (result.code != 200) {
                   messageAlert('提示', result.message, 'error');
               } else {
                   $('#dlg').dialog('close');        // close the dialog
                   $('#dg').datagrid('reload');    // reload the user data
                   messageAlert('提示', result.message, 'info');
               }
           }
       });
  }


</script>
</body>
</html>